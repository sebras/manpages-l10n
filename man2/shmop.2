.\ Copyright 1993 Giorgio Ciucci (giorgio@crcc.it)
.\
.\ Permission is granted to make and distribute verbatim copies of this
.\ manual provided the copyright notice and this permission notice are
.\ preserved on all copies.
.\
.\ Permission is granted to copy and distribute modified versions of this
.\ manual under the conditions for verbatim copying, provided that the
.\ entire resulting derived work is distributed under the terms of a
.\ permission notice identical to this one
.\ 
.\ Since the Linux kernel and libraries are constantly changing, this
.\ manual page may be incorrect or out-of-date.  The author(s) assume no
.\ responsibility for errors or omissions, or for damages resulting from
.\ the use of the information contained herein.  The author(s) may not
.\ have taken the same level of care in the production of this manual,
.\ which is licensed free of charge, as they might when working
.\ professionally.
.\ 
.\ Formatted or processed versions of this manual, if unaccompanied by
.\ the source, must acknowledge the copyright and authors of this work.
.\
.\ Modified Sun November 28 17:06:19 1993, Rik Faith (faith@cs.unc.edu)
.\          with material from Luigi P. Bai (lpb@softint.com)
.\ Portions Copyright 1993 Luigi P. Bai
.\ Modified Tue Oktober 22 22:04:23 1996 by Eric S. Raymond <esr@thyrsus.com>
.\
.\ Translated into German by Ralf Demmer, Translation & Consulting
.\ rdemmer@rdemmer.de, http://www.rdemmer.de
.\ Berlin, 29.1.1999
.\
.TH SHMOP 2 November 28, 1993 Linux 0.99.13 Linux Programmer's Manual 
.SH BEZEICHNUNG
shmop \- Gemeinsame Speicheroperationen
.SH "šBERSICHT"
.nf
.B
# include <sys/types.h>
.B
# include <sys/ipc.h>
.B
# include <sys/shm.h>
.fi
.sp
.BI char *shmat ( int  shmid ,
.BI char * shmaddr ,
.BI int  shmflg  )
.sp
.BI int shmdt ( char * shmaddr )
.SH BESCHREIBUNG
Die Funktion
.B shmat
h„ngt das durch 
.B shmid
erkannte gemeinsame Speichersegment an das Datensegment des aufrufenden Prozesses an.
Die Adresse des Anhangs wird durch 
.I shmaddr
nach einem der folgenden Kriterien bestimmt:
.IP
Wenn 
.I shmaddr
.BR 0 
ist, versucht das System einen noch nicht zugeordneten Bereich zwischen 1 \- 1.5G zu finden (von oben beginnend und abw„rts verlaufend).
.IP
Wenn 
.I shmaddr
nicht 
.B 0
ist und 
.B SHM_RND
in 
.IR shmflg ,
gesetzt ist, wird die Adresse durch Abrundung von 
.I shmaddr
als Vielfaches von 
.BR SHMLBA 
bestimmt.
Andernfalls mu˜ 
.I shmaddr
eine an einem Speicherblock ausgerichtete Adresse sein, an welcher der Anhang beginnt.
.PP
Ist 
.B SHM_RDONLY
in 
.IR shmflg ,
gesetzt, wird das Segment fr Lesezugriffe angeh„ngt und der Proze˜ mu˜ die Berechtigung fr Lesezugriffe auf das Segment besitzen.
Alternativ wird das Segment fr Lese- und Schreibzugriffe angeh„ngt und der Proze˜ mu˜ die Berechtigung fr Lese- und Schreibzugriffe auf das Segment besitzen.
Es besteht kein sinnvoller Anwendungsbedarf fr Speichersegmente mit gemeinsamem Zugriff mit ausschlie˜licher Schreibberechtigung.
.PP
Der 
.B brk
-Wert des aufrufenden Prozesses wird durch das Anh„ngen nicht ver„ndert.
Das Segment wird bei Beenden des Prozesses automatisch entfernt.
Ein und dasselbe Segment kann mit Lese- bzw. Lese- und Schreibzugriff einmal oder mehrfach an den Adressraum des Prozesses angeh„ngt werden.
.PP
Nach einem erfolgreichen 
.B shmat
-Aufruf, aktualisiert das System die Bestandteile der dem Speichersegment zugeordneten Struktur
.B shmid_ds
wie folgt:
.IP
.B shm_atime
wird auf die aktuelle Zeit gesetzt.
.IP
.B shm_lpid
wird mit der Proze˜-ID des aufrufenden Prozesses berschrieben.
.IP
.B shm_nattch
wird um 1 erh÷ht.
.PP
Beachten Sie, da˜ das Anh„ngen auch erfolgreich verlaufen kann, wenn das gemeinsame Speichersegment als "zu l÷schen" markiert ist.
.PP
Die Funktion 
.B shmdt
entfernt das gemeinsame Speichersegment aus dem Datensegment des aufrufenden Prozesses, in welchem dieses sich an der durch 
.IR shmaddr 
angegebenen Adresse befindet.
Das zu entfernende gemeinsame Speichersegment mu˜ eines der momentan (am Adressraum des Prozesses) angeh„ngten sein, wobei 
.I shmaddr
dem Rckgabewert des anh„ngenden 
.B shat
-Aufrufs entspricht.
.PP
Nach einem erfolgreichen 
.B shmdt
-Aufruf, aktualisiert das System die Bestandteile der dem Speichersegment zugeordneten Struktur
.B shmid_ds
wie folgt:
.IP
.B shm_dtime
wird auf die aktuelle Zeit gesetzt.
.IP
.B shm_lpid
wird mit der Proze˜-ID des aufrufenden Prozesses berschrieben.
.IP
.B shm_nattch
wird um 1 verringert.
Wenn es dabei zu 0 wird und das Segment zum L÷schen markiert ist, wird es gel÷scht.
.PP
Der eingenommene Bereich im Benutzerspeicherbereich des aufrufenden Prozesses wird freigegeben.
.PP
.SH SYSTEM CALLS
.TP
.B fork()
Nach einem 
.B fork()
erbt der Kind-Proze˜ das angeh„ngte gemeinsame Speichersegment.
.TP
.B exec()
Nach einem 
.B exec()
sind alle angeh„ngten gemeinsamen Speichersegmente entkoppelt (nicht zerst÷rt).
.TP
.B exit()
Nach einem
.B exit()
sind alle angeh„ngten gemeinsamen Speichersegmente entkoppelt (nicht zerst÷rt).
.PP
.SH "RšCKGABEWERT"
Nach einem Fehler geben beide Funktionen 
.B \-1
in
.B errno
zurck und weisen so auf den Fehler hin.
Andernfalls gibt
.B shmat
die Adresse des angeh„ngten Speichersegments und
.B shmdt
gibt 
.BR 0 
zurck.
.SH FEHLER
Wenn 
.B shmat
fehlschl„gt, ist 
.B errno
nach dem Rcksprung mit einem der folgenden Werte belegt:
.TP 11
.B EACCES
Der aufrufende Proze˜ hat keine Zugriffsrechte fr den angeforderten Anhangtyp.
.TP
.B EINVAL
Ungltiger
.I shmid
-Wert, nicht zugeordneter (d.h. nicht seitenkonform und \fBSHM_RND\fP wurde nicht angegeben) oder ungltiger
.I shmaddr
-Wert oder das Anh„ngen bei 
.BR brk 
schlug fehl.
.TP
.B ENOMEM
Es konnte kein Speicher fr den Descriptor oder die Seitentabellen bereitgestellt werden.
.PP
Die Funktion 
.B shmdt
schl„gt nur fehl, wenn an der Adresse
.IR shmaddr 
kein gemeinsames Speichersegment angeh„ngt ist. In diesem Fall wird 
.B errno
bei der Rckgabe auf
.BR EINVAL 
gesetzt.
.SH ANMERKUNGEN
Bei Ausfhrung eines 
.BR fork (2)
-Systemaufrufs, erbt der Kind-Proze˜ alle angeh„ngten gemeinsamen Speichersegmente.
.PP
Das gemeinsame Speichersegment eines Prozesses der einen 
.BR execve (2)
-Systemaufruf ausfhrt wird nicht an den daraus entstandenen Proze˜ angeh„ngt.
.PP
Der folgende Systemparameter beeinflu˜t einen 
.B shmat
-Systemaufruf:
.TP 11
.B SHMLBA
Adresskoefizient der Segmentuntergrenze.
Mu˜ seitenkonform sein.
In der aktuellen Umsetzung ist der Wert 
.B SHMBLA
gleich 
.BR PAGE_SIZE .
.PP
Die Umsetzung hat keinen inneren Einschr„nkungen der maximalen Anzahl von Speichersegmenten pro Proze˜
.RB ( SHMSEG )
.SH "KONFORM ZU"
SVr4, SVID.  Unter SVr4 ist eine weitere Fehlerbedingung EMFILE dokumentiert.
.SH "SIEHE AUCH"
.BR ipc (5),
.BR shmctl (2),
.BR shmget (2).
